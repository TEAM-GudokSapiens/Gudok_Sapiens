{% extends 'base.html' %}

{% block content %}
    <head>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
    </head>
    <div class="community_navbar"> <!--확인차 넣어둔 커뮤니티 navbar-->
        <span><a href="{%url 'community:notice'%}">공지사항 </a></span>
        <span><a href="{%url 'community:magazine'%}">매거진 </a></span>
        <span><a href="{%url 'community:board'%}">자유게시판 </a></span>
        <form method="GET" action="{% url 'community:search' %}">
            {% csrf_token %}
                <input type='text' name='search_key' value="{{ search_key }}" placeholder='Search' />
                <input type='submit' value="Search" />
        </form>
        <hr>
    </div>
    <!--------------------------------------------------------------------->
    
    {{ board.update_counter }}
    <h3>{{ board.title }}</h3>
    작성일: {{ board.created_at  | date:"Y/m/d" }} <br>
    좋아요
    <div id="{{board.id}}" onclick="post_like(this.id)">
        {%if request.user in board.like.all%}
        <!-- 로그인 한 유저가 좋아요를 누른 유저일때  -->
        <i id="heart" class="fas fa-heart"></i>
        {%else%}
        <!-- 로그인 한 유저가 좋아요를 누른 유저가 아닐 때  -->
        <i id="heart" class="far fa-heart"></i>
        {%endif%}
        <div id="like_count">{{board.like.count}}개</div>
    </div>
    

    조회수 : {{ board.hits }} <br>
    <hr>
    {{ board.content }} <br>
    
    {% if board.img %}
    <img src="{{ board.img.url }}" style="width: 450px;"> <br>
    {% else %}
    <p></p>
    {% endif %}

    <hr>
    <a href="{%url 'community:board'%}">목록으로 </a> <br>

    <!--로그인한 사람 == 작성자 일때만 삭제가능-->
    {% if user.username == board.user.username %}
    <a href="{% url 'community:board_delete' board.id %}">삭제하기</a>
    {% endif %}

    <script src="https://code.jquery.com/jquery-3.5.1.js"
    integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function post_like(id) {
            console.log("hi")
            $.ajax({
                url: "{%url 'community:likes'%}", 
                data: {
                    'board_id': id
                }, 
                dataType: "json",
                success: function (response) {
                    $('#like_count').html(response.like_count+'개') 
                    $('#message').html(response.message) 
                    if (response.message == "좋아요")
                    //좋아요 눌렀을 때 
                    {
                        $('#heart').attr("class", "fas fa-heart")
                    } else if (response.message == "좋아요 취소")
                    //좋아요 상태에서 다시 눌렀을 때 
                    {
                        $('#heart').attr("class", "far fa-heart")
                    }
                }
            })
        }
    </script>
  
{% endblock %}